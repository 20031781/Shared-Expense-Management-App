export type Language = 'en' | 'it';

export const translations = {
    en: {
        common: {
            ok: 'OK',
            cancel: 'Cancel',
            close: 'Close',
            confirm: 'Confirm',
            error: 'Error',
            success: 'Success',
            genericError: 'Something went wrong. Please try again.',
            pullToRefresh: 'Pull to refresh',
            settings: 'Settings',
            language: 'Language',
            comingSoon: 'Coming soon',
        },
        navigation: {
            lists: 'Lists',
            settings: 'Settings',
        },
        lists: {
            myLists: 'My Lists',
            createList: 'Create List',
            details: 'List Details',
            createListTitle: 'Create a new list',
            createListSubtitle: 'Give your expense list a friendly name.',
            nameLabel: 'List name',
            namePlaceholder: 'e.g., Weekend Trip, Apartment, etc.',
            nameRequired: 'List name is required',
            createSuccess: 'List created successfully',
            createError: 'Failed to create the list. Please try again.',
            expensesTab: ({count}: {count: number}) => `Expenses (${count})`,
            membersTab: ({count}: {count: number}) => `Members (${count})`,
            invite: 'Share Invite',
            inviteDescription: ({code}: {code: string}) => `Share this code with others to join: ${code}`,
            emptyExpenses: 'No expenses yet',
            emptyMembers: 'No members yet',
            addExpense: 'Add Expense',
            addMember: 'Add Member',
            summaryTitle: 'Expense summary',
            totalSpent: 'Total spent',
            perMember: 'Spent per member',
            filterLabel: 'Timeframe',
            filterAll: 'All',
            filter7: '7d',
            filter30: '30d',
            filter90: '90d',
            chartEmpty: 'Add expenses to unlock the chart.',
            emptyTitle: 'No lists yet',
            emptySubtitle: 'Create your first list or join an existing one',
            deleteTitle: 'Delete List',
            deleteBody: ({name}: {name: string}) => `Are you sure you want to delete "${name}"?`,
            deleteSuccess: 'List deleted successfully',
            deleteError: 'Unable to delete the list. Please try again.',
            joinTitle: 'Join a list',
            joinDescription: 'Enter the invite code you received to join instantly.',
            joinPlaceholder: 'Invite code (e.g. ABC123)',
            joinHelper: 'Codes are not case-sensitive.',
            joinSubmit: 'Join list',
            joinSuccess: 'Invite accepted! You now have access to the list.',
            joinError: 'Unable to join the list. Double check the code and try again.',
            acceptSuccess: 'Invite accepted! You now have access to the list.',
            acceptError: 'Unable to accept the invite. Ask the admin to resend the link.',
            joinCodeRequired: 'Invite code is required.',
            inviteShareError: 'Unable to open WhatsApp. Copy the invite code manually.',
            inviteFallbackTitle: 'Share this code',
            inviteFallbackBody: ({code}: {code: string}) => `Share this code on WhatsApp: ${code}`,
        },
        expenses: {
            newExpense: 'New Expense',
            titleLabel: 'Title',
            titlePlaceholder: 'E.g. Dinner, fuel...',
            amountLabel: 'Amount',
            notesLabel: 'Notes (optional)',
            notesPlaceholder: 'Add any additional details...',
            addReceiptCamera: 'Take Photo',
            addReceiptGallery: 'Choose Photo',
            receiptLabel: 'Receipt Photo (optional)',
            createButton: 'Create Expense',
            cancelButton: 'Cancel',
            titleRequired: 'Title is required',
            amountRequired: 'Amount must be greater than 0',
            payerLabel: 'Paid by',
            payerPlaceholder: 'Select a member',
            payerHelper: 'Select the member who actually paid the bill.',
            payerRequired: 'Please choose who paid',
            missingMembersHelper: 'Invite at least one member to log a payment.',
            createdSuccess: 'Expense created successfully',
            paidBy: ({name}: {name: string}) => `Paid by ${name}`,
            spentOn: ({date}: {date: string}) => `Spent on ${date}`,
            insertedOn: ({date}: {date: string}) => `Inserted on ${date}`,
            permissionPhotos: 'Please allow access to your photos',
            permissionCamera: 'Please allow access to your camera',
            receiptAdded: 'Receipt added',
            status: {
                draft: 'Draft',
                submitted: 'Awaiting approval',
                validated: 'Approved',
                rejected: 'Rejected',
            },
            pendingValidation: 'Waiting for validators',
        },
        members: {
            title: 'Add Member',
            emailLabel: 'Email',
            displayNameLabel: 'Display name (optional)',
            displayNamePlaceholder: 'E.g. Luca - Room 3',
            displayNameHint: 'Shown everywhere in the list. Leave it empty to use the email.',
            splitLabel: 'Split %',
            validatorLabel: 'Is validator',
            submit: 'Invite member',
            successTitle: 'Member invited',
            successBody: 'The member received the invitation.',
            emailRequired: 'Email is required',
            splitRequired: 'Split must be between 0 and 100',
            validatorHint: 'Validators can approve expenses',
            splitInfo: 'Percentages can be edited later by an administrator.',
            validatorBadge: 'Validator',
            editTitle: 'Manage member',
            splitValue: ({value}: {value: number}) => `Split: ${value.toFixed(2)}%`,
            editSubmit: 'Save changes',
            editSuccess: 'Member updated successfully',
            removeButton: 'Remove member',
            removeTitle: 'Remove member',
            removeBody: ({email}: {email: string}) => `Remove ${email} from this list?`,
            removeConfirm: 'Remove',
            removeSuccess: 'Member removed',
            statusLabel: 'Status',
            statusHint: 'Only administrators can change this field.',
            statusActive: 'Active',
            statusPending: 'Pending',
            statusActiveShort: 'Active',
            statusPendingShort: 'Pending',
            statusLegend: 'ðŸŸ¢ Active Â· ðŸŸ¡ Pending â€“ the member has not accepted the invite yet.',
            pendingExplanation: 'The yellow dot means the member has not accepted the invite yet.',
            unknown: 'Unknown member',
        },
        settings: {
            title: 'Settings',
            languageLabel: 'Language',
            english: 'English',
            italian: 'Italian',
            languageDescription: 'Choose the language used across the application.',
            themeLabel: 'Theme',
            themeDescription: 'Customize the look & feel of the app.',
            themeLight: 'Light',
            themeDark: 'Dark',
            themeSystem: 'Match system',
        },
        auth: {
            title: 'Split Expenses',
            subtitle: 'Share expenses with friends and family',
            emailPlaceholder: 'Email',
            passwordPlaceholder: 'Password',
            signIn: 'Sign In',
            signUp: 'Sign Up',
            toggleToSignUp: "Don't have an account? Sign Up",
            toggleToSignIn: 'Already have an account? Sign In',
            missingFields: 'Please enter email and password',
            signUpSuccess: 'Account created successfully!',
            terms: 'By continuing, you agree to our Terms of Service and Privacy Policy',
        },
    },
    it: {
        common: {
            ok: 'OK',
            cancel: 'Annulla',
            close: 'Chiudi',
            confirm: 'Conferma',
            error: 'Errore',
            success: 'Successo',
            genericError: 'Qualcosa Ã¨ andato storto. Riprova.',
            pullToRefresh: 'Trascina per aggiornare',
            settings: 'Impostazioni',
            language: 'Lingua',
            comingSoon: 'Prossimamente',
        },
        navigation: {
            lists: 'Liste',
            settings: 'Impostazioni',
        },
        lists: {
            myLists: 'Le mie liste',
            createList: 'Crea lista',
            details: 'Dettagli lista',
            createListTitle: 'Crea una nuova lista',
            createListSubtitle: 'Dai un nome al tuo gruppo di spesa.',
            nameLabel: 'Nome lista',
            namePlaceholder: 'Es. Weekend, Casa, ecc.',
            nameRequired: 'Il nome della lista Ã¨ obbligatorio',
            createSuccess: 'Lista creata correttamente',
            createError: 'Impossibile creare la lista. Riprova.',
            expensesTab: ({count}: {count: number}) => `Spese (${count})`,
            membersTab: ({count}: {count: number}) => `Membri (${count})`,
            invite: 'Condividi invito',
            inviteDescription: ({code}: {code: string}) => `Condividi questo codice per unirti: ${code}`,
            emptyExpenses: 'Ancora nessuna spesa',
            emptyMembers: 'Ancora nessun membro',
            addExpense: 'Aggiungi spesa',
            addMember: 'Aggiungi membro',
            summaryTitle: 'Riepilogo spese',
            totalSpent: 'Totale speso',
            perMember: 'Spesa per membro',
            filterLabel: 'Intervallo',
            filterAll: 'Tutte',
            filter7: '7g',
            filter30: '30g',
            filter90: '90g',
            chartEmpty: 'Aggiungi spese per visualizzare il grafico.',
            emptyTitle: 'Ancora nessuna lista',
            emptySubtitle: 'Crea la tua prima lista o unisciti a una esistente',
            deleteTitle: 'Elimina lista',
            deleteBody: ({name}: {name: string}) => `Eliminare davvero "${name}"?`,
            deleteSuccess: 'Lista eliminata con successo',
            deleteError: 'Impossibile eliminare la lista. Riprova.',
            joinTitle: 'Unisciti a una lista',
            joinDescription: 'Inserisci il codice invito ricevuto per entrare subito.',
            joinPlaceholder: 'Codice invito (es. ABC123)',
            joinHelper: 'Il codice non fa distinzione tra maiuscole e minuscole.',
            joinSubmit: 'Unisciti',
            joinSuccess: 'Invito accettato! Ora puoi accedere alla lista.',
            joinError: 'Impossibile unirsi alla lista. Controlla il codice e riprova.',
            acceptSuccess: 'Invito accettato! Ora puoi accedere alla lista.',
            acceptError: 'Non riesco a confermare il tuo invito. Chiedi allâ€™admin di reinviare il link.',
            joinCodeRequired: 'Il codice invito Ã¨ obbligatorio.',
            inviteShareError: 'Non riesco ad aprire WhatsApp. Copia il codice manualmente.',
            inviteFallbackTitle: 'Condividi il codice',
            inviteFallbackBody: ({code}: {code: string}) => `Codice da inviare su WhatsApp: ${code}`,
        },
        expenses: {
            newExpense: 'Nuova spesa',
            titleLabel: 'Titolo',
            titlePlaceholder: 'Es. Cena, benzina...',
            amountLabel: 'Importo',
            notesLabel: 'Note (opzionali)',
            notesPlaceholder: 'Aggiungi dettagli aggiuntivi...',
            addReceiptCamera: 'Scatta foto',
            addReceiptGallery: 'Scegli foto',
            receiptLabel: 'Foto ricevuta (opzionale)',
            createButton: 'Crea spesa',
            cancelButton: 'Annulla',
            titleRequired: 'Il titolo Ã¨ obbligatorio',
            amountRequired: "L'importo deve essere maggiore di 0",
            payerLabel: 'Ha pagato',
            payerPlaceholder: 'Seleziona un membro',
            payerHelper: 'Indica il membro che ha pagato la spesa.',
            payerRequired: 'Seleziona chi ha pagato',
            missingMembersHelper: 'Invita almeno un membro per registrare la spesa.',
            createdSuccess: 'Spesa creata con successo',
            paidBy: ({name}: {name: string}) => `Pagata da ${name}`,
            spentOn: ({date}: {date: string}) => `Spesa del ${date}`,
            insertedOn: ({date}: {date: string}) => `Inserita il ${date}`,
            permissionPhotos: 'Consenti accesso alla galleria per continuare',
            permissionCamera: 'Consenti accesso alla fotocamera per continuare',
            receiptAdded: 'Ricevuta aggiunta',
            status: {
                draft: 'Bozza',
                submitted: 'In attesa',
                validated: 'Approvata',
                rejected: 'Rifiutata',
            },
            pendingValidation: 'In attesa dei validatori',
        },
        members: {
            title: 'Aggiungi membro',
            emailLabel: 'Email',
            displayNameLabel: 'Nome visualizzato (opzionale)',
            displayNamePlaceholder: 'Es. Luca - Camera 3',
            displayNameHint: 'ComparirÃ  in tutta la lista. Lascia vuoto per usare lâ€™email.',
            splitLabel: 'Percentuale',
            validatorLabel: 'Ãˆ validatore',
            submit: 'Invita membro',
            successTitle: 'Invito inviato',
            successBody: "Il membro ha ricevuto l'invito.",
            emailRequired: "L'email Ã¨ obbligatoria",
            splitRequired: 'La percentuale deve essere tra 0 e 100',
            validatorHint: 'I validatori possono approvare le spese',
            splitInfo: 'Le percentuali possono essere modificate in seguito da un amministratore.',
            validatorBadge: 'Validatore',
            editTitle: 'Gestisci membro',
            splitValue: ({value}: {value: number}) => `Percentuale: ${value.toFixed(2)}%`,
            editSubmit: 'Salva modifiche',
            editSuccess: 'Membro aggiornato correttamente',
            removeButton: 'Rimuovi membro',
            removeTitle: 'Rimuovi membro',
            removeBody: ({email}: {email: string}) => `Vuoi rimuovere ${email} dalla lista?`,
            removeConfirm: 'Rimuovi',
            removeSuccess: 'Membro rimosso',
            statusLabel: 'Stato',
            statusHint: "Solo l'amministratore puÃ² modificare questo campo.",
            statusActive: 'Attivo',
            statusPending: 'In attesa',
            statusActiveShort: 'Attivo',
            statusPendingShort: 'In attesa',
            statusLegend: 'ðŸŸ¢ Attivo Â· ðŸŸ¡ In attesa: il membro non ha ancora accettato lâ€™invito.',
            pendingExplanation: 'Il pallino giallo indica che il membro deve ancora accettare lâ€™invito.',
            unknown: 'Membro sconosciuto',
        },
        settings: {
            title: 'Impostazioni',
            languageLabel: 'Lingua',
            english: 'Inglese',
            italian: 'Italiano',
            languageDescription: "Scegli la lingua utilizzata nell'app.",
            themeLabel: 'Tema',
            themeDescription: "Personalizza l'aspetto dell'app.",
            themeLight: 'Chiaro',
            themeDark: 'Scuro',
            themeSystem: 'Come il sistema',
        },
        auth: {
            title: 'Split Expenses',
            subtitle: 'Condividi le spese con amici e famiglia',
            emailPlaceholder: 'Email',
            passwordPlaceholder: 'Password',
            signIn: 'Accedi',
            signUp: 'Registrati',
            toggleToSignUp: "Non hai un account? Registrati",
            toggleToSignIn: 'Hai giÃ  un account? Accedi',
            missingFields: 'Inserisci email e password',
            signUpSuccess: 'Account creato con successo!',
            terms: "Continuando accetti i Termini di servizio e l'Informativa sulla privacy",
        },
    },
};

export const availableLanguages: {code: Language; labelKey: string}[] = [
    {code: 'en', labelKey: 'settings.english'},
    {code: 'it', labelKey: 'settings.italian'},
];

const FALLBACK_LANGUAGE: Language = 'en';

const traverse = (language: Language, key: string): any => {
    const segments = key.split('.');
    let current: any = translations[language as Language];

    for (const segment of segments) {
        if (typeof current !== 'object' || current === null) {
            return undefined;
        }
        current = current[segment];
        if (current === undefined) return undefined;
    }
    return current;
};

export const translate = (language: Language, key: string, params?: Record<string, any>): string => {
    const raw = traverse(language, key) ?? traverse(FALLBACK_LANGUAGE, key);

    if (typeof raw === 'function') {
        return raw(params ?? {});
    }

    if (typeof raw !== 'string') {
        return key;
    }

    if (!params) {
        return raw;
    }

    return Object.keys(params).reduce((acc, paramKey) => {
        const value = params[paramKey];
        return acc.replace(new RegExp(`{{${paramKey}}}`, 'g'), String(value));
    }, raw);
};
